<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js oranda-dark">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Development guide</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">
        <link rel="stylesheet" href="../oranda-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "oranda-dark" : "oranda-dark";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('orandamdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('orandamdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('orandamdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('oranda-dark')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../chapter_1.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../topics/preparation.html"><strong aria-hidden="true">2.</strong> Preparation</a></li><li class="chapter-item expanded "><a href="../topics/quickstart.html"><strong aria-hidden="true">3.</strong> Getting started</a></li><li class="chapter-item expanded "><a href="../topics/managing-ssh-keys.html"><strong aria-hidden="true">4.</strong> Managing SSH Keys</a></li><li class="chapter-item expanded "><a href="../topics/node-image.html"><strong aria-hidden="true">5.</strong> Node Images</a></li><li class="chapter-item expanded "><a href="../topics/production-environment.html"><strong aria-hidden="true">6.</strong> Production Environment</a></li><li class="chapter-item expanded "><a href="../topics/advanced-caph.html"><strong aria-hidden="true">7.</strong> Advanced CAPH</a></li><li class="chapter-item expanded "><a href="../topics/upgrade.html"><strong aria-hidden="true">8.</strong> Upgrading CAPH</a></li><li class="chapter-item expanded "><a href="../reference/index.html"><strong aria-hidden="true">9.</strong> General</a></li><li class="chapter-item expanded "><a href="../reference/hetzner-cluster.html"><strong aria-hidden="true">10.</strong> HetznerCluster</a></li><li class="chapter-item expanded "><a href="../reference/hcloud-machine-template.html"><strong aria-hidden="true">11.</strong> HCloudMachineTemplate</a></li><li class="chapter-item expanded "><a href="../reference/hetzner-bare-metal-host.html"><strong aria-hidden="true">12.</strong> HetznerBareMetalHost</a></li><li class="chapter-item expanded "><a href="../reference/hetzner-bare-metal-machine-template.html"><strong aria-hidden="true">13.</strong> HetznerBareMetalMachineTemplate</a></li><li class="chapter-item expanded "><a href="../reference/hetzner-bare-metal-remediation-template.html"><strong aria-hidden="true">14.</strong> HetznerBareMetalRemediationTemplate</a></li><li class="chapter-item expanded "><a href="../developers/development.html" class="active"><strong aria-hidden="true">15.</strong> Development guide</a></li><li class="chapter-item expanded "><a href="../developers/tilt.html"><strong aria-hidden="true">16.</strong> Tilt</a></li><li class="chapter-item expanded "><a href="../developers/releasing.html"><strong aria-hidden="true">17.</strong> Releasing</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="oranda-dark">Axo Dark</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="oranda-light">Axo Light</button></li>

                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="developing-cluster-api-provider-hetzner"><a class="header" href="#developing-cluster-api-provider-hetzner">Developing Cluster API Provider Hetzner</a></h1>
<p>Developing our provider is quite easy. First, you need to install some base requirements. Second, you need to follow the quickstart documents to set up everything related to Hetzner. Third, you need to configure your tilt set-up. After having done those three steps, you can start developing with the local Kind cluster and the Tilt UI to create one of the different workload clusters that are already pre-configured. </p>
<h2 id="install-base-requirements"><a class="header" href="#install-base-requirements">Install Base requirements</a></h2>
<p>In order to develop with Tilt, there are a few requirements. You can use the following command to check whether the versions of the tools are up-to-date and to install ones that are missing (for both Mac &amp; Linux): <code>make install-dev-prerequisites</code></p>
<p>This ensures the following:</p>
<ul>
<li>clusterctl</li>
<li>ctlptl (required)</li>
<li>go (required)</li>
<li>helm (required)</li>
<li>helmfile </li>
<li>kind (required)</li>
<li>kubectl (required)</li>
<li>packer</li>
<li>tilt (required)</li>
<li>hcloud</li>
</ul>
<p>Some of them like helmfile or packer are not needed for developing the controller, but very helpful if you are developing images or stuff for production use.</p>
<h2 id="preparing-hetzner-project"><a class="header" href="#preparing-hetzner-project">Preparing Hetzner project</a></h2>
<p>For more information, please see <a href="/docs/topics/preparation.html">here</a>.</p>
<h2 id="setting-tilt-up"><a class="header" href="#setting-tilt-up">Setting Tilt up</a></h2>
<p>You need to create a <code>tilt-settings.json</code> file and specify the values you need. Here is an example:</p>
<pre><code class="language-json">{
  &quot;kustomize_substitutions&quot;: {
      &quot;HCLOUD_TOKEN&quot;: &quot;&lt;hcloud-token&gt;&quot;,
      &quot;HCLOUD_SSH_KEY&quot;: &quot;test&quot;,
      &quot;HCLOUD_REGION&quot;: &quot;fsn1&quot;,
      &quot;CONTROL_PLANE_MACHINE_COUNT&quot;: &quot;3&quot;,
      &quot;WORKER_MACHINE_COUNT&quot;: &quot;3&quot;,
      &quot;KUBERNETES_VERSION&quot;: &quot;v1.28.4&quot;,
      &quot;HCLOUD_IMAGE_NAME&quot;: &quot;1.28.4-ubuntu-22-04-containerd&quot;,
      &quot;HCLOUD_CONTROL_PLANE_MACHINE_TYPE&quot;: &quot;cpx31&quot;,
      &quot;HCLOUD_WORKER_MACHINE_TYPE&quot;: &quot;cpx31&quot;,
      &quot;CLUSTER_NAME&quot;: &quot;testing&quot;,
      &quot;HETZNER_SSH_PUB_PATH&quot;: &quot;&lt;path-to-public-ssh-key&gt;&quot;,
      &quot;HETZNER_SSH_PRIV_PATH&quot;: &quot;&lt;path-to-private-ssh-key&gt;&quot;,
      &quot;HETZNER_ROBOT_USER&quot;: &quot;&lt;robot-user&gt;&quot;,
      &quot;HETZNER_ROBOT_PASSWORD&quot;: &quot;&lt;robot-password&gt;&quot;
  },
}
</code></pre>
<p>The complete reference can be found <a href="/docs/developers/tilt.html">here</a>.</p>
<h2 id="developing-with-tilt"><a class="header" href="#developing-with-tilt">Developing with Tilt</a></h2>
<p align="center">
<img alt="tilt" src="../pics/tilt.png" width=800px/>
</p> 
<p>Provider Integration development requires a lot of iteration, and the “build, tag, push, update deployment” workflow can be very tedious. Tilt makes this process much simpler by watching for updates and automatically building and deploying them. To build a kind cluster and to start Tilt, run:</p>
<pre><code class="language-shell">make tilt-up
</code></pre>
<blockquote>
<p>To access the Tilt UI, please go to: <code>http://localhost:10350</code></p>
</blockquote>
<p>Once your kind management cluster is up and running, you can deploy a workload cluster. This could be done through the Tilt UI by pressing one of the buttons in the top right corner, e.g., <strong>&quot;Create Workload Cluster - without Packer&quot;</strong>. This triggers the <code>make create-workload-cluster</code> command, which uses the environment variables (we defined in the tilt-settings.json) and the cluster-template. Additionally, it installs cilium as CNI.</p>
<p>If you update the API in some way, you need to run <code>make generate</code> to generate everything related to kubebuilder and the CRDs.</p>
<p>To tear down the workload cluster, press the <strong>&quot;Delete Workload Cluster&quot;</strong> button. After a few minutes, the resources should be deleted. </p>
<p>To tear down the kind cluster, use:</p>
<pre><code class="language-shell">$ make delete-mgt-cluster
</code></pre>
<p>To delete the registry, use: <code>make delete-registry</code> or <code>make delete-mgt-cluster-registry</code>.</p>
<p>If you have any trouble finding the right command, you can run the <code>make help</code> command to get a list of all available make targets. </p>
<h2 id="submitting-prs-and-testing"><a class="header" href="#submitting-prs-and-testing">Submitting PRs and testing</a></h2>
<p>Pull requests and issues are highly encouraged! For more information, please have a look at the <a href="../../CONTRIBUTING.html">Contribution Guidelines</a></p>
<p>There are two important commands that you should make use of before creating the PR.</p>
<p>With <code>make verify</code>, you can run all linting checks and others. Make sure that all of these checks pass - otherwise, the PR cannot be merged. Note that you need to commit all changes for the last checks to pass. </p>
<p>With <code>make test</code>, all unit tests are triggered. If they fail out of nowhere, then please re-run them. They are not 100% stable and sometimes there are tests failing due to something related to Kubernetes' <code>envtest</code>.</p>
<p>With <code>make generate</code>, new CRDs are generated. This is necessary if you change the API.</p>
<h3 id="running-local-e2e-test"><a class="header" href="#running-local-e2e-test">Running local e2e test</a></h3>
<p>If you are interested in running the E2E tests locally, then you can use the following commands:</p>
<pre><code>export HCLOUD_TOKEN=&lt;your-hcloud-token&gt;
export CAPH_LATEST_VERSION=&lt;latest-version&gt;
export HETZNER_ROBOT_USER=&lt;your robot user&gt;
export HETZNER_ROBOT_PASSWORD=&lt;your robot password&gt;
export HETZNER_SSH_PUB=&lt;your-ssh-pub-key&gt;
export HETZNER_SSH_PRIV=&lt;your-ssh-private-key&gt;
make test-e2e
</code></pre>
<p>For the SSH public and private keys, you should use the following command to encode the keys. Note that the E2E test will not work if the ssh key is in any other format!</p>
<pre><code>export HETZNER_SSH_PRIV=$(cat ~/.ssh/cluster | base64 -w0)
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../reference/hetzner-bare-metal-remediation-template.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../developers/tilt.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../reference/hetzner-bare-metal-remediation-template.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../developers/tilt.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
