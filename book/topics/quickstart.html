<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js oranda-dark">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Getting started</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">
        <link rel="stylesheet" href="../oranda-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "oranda-dark" : "oranda-dark";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('orandamdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('orandamdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('orandamdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('oranda-dark')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../chapter_1.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../topics/preparation.html"><strong aria-hidden="true">2.</strong> Preparation</a></li><li class="chapter-item expanded "><a href="../topics/quickstart.html" class="active"><strong aria-hidden="true">3.</strong> Getting started</a></li><li class="chapter-item expanded "><a href="../topics/managing-ssh-keys.html"><strong aria-hidden="true">4.</strong> Managing SSH Keys</a></li><li class="chapter-item expanded "><a href="../topics/node-image.html"><strong aria-hidden="true">5.</strong> Node Images</a></li><li class="chapter-item expanded "><a href="../topics/production-environment.html"><strong aria-hidden="true">6.</strong> Production Environment</a></li><li class="chapter-item expanded "><a href="../topics/advanced-caph.html"><strong aria-hidden="true">7.</strong> Advanced CAPH</a></li><li class="chapter-item expanded "><a href="../topics/upgrade.html"><strong aria-hidden="true">8.</strong> Upgrading CAPH</a></li><li class="chapter-item expanded "><a href="../reference/index.html"><strong aria-hidden="true">9.</strong> General</a></li><li class="chapter-item expanded "><a href="../reference/hetzner-cluster.html"><strong aria-hidden="true">10.</strong> HetznerCluster</a></li><li class="chapter-item expanded "><a href="../reference/hcloud-machine-template.html"><strong aria-hidden="true">11.</strong> HCloudMachineTemplate</a></li><li class="chapter-item expanded "><a href="../reference/hetzner-bare-metal-host.html"><strong aria-hidden="true">12.</strong> HetznerBareMetalHost</a></li><li class="chapter-item expanded "><a href="../reference/hetzner-bare-metal-machine-template.html"><strong aria-hidden="true">13.</strong> HetznerBareMetalMachineTemplate</a></li><li class="chapter-item expanded "><a href="../reference/hetzner-bare-metal-remediation-template.html"><strong aria-hidden="true">14.</strong> HetznerBareMetalRemediationTemplate</a></li><li class="chapter-item expanded "><a href="../developers/development.html"><strong aria-hidden="true">15.</strong> Development guide</a></li><li class="chapter-item expanded "><a href="../developers/tilt.html"><strong aria-hidden="true">16.</strong> Tilt</a></li><li class="chapter-item expanded "><a href="../developers/releasing.html"><strong aria-hidden="true">17.</strong> Releasing</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="oranda-dark">Axo Dark</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="oranda-light">Axo Light</button></li>

                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="quickstart-guide"><a class="header" href="#quickstart-guide">Quickstart Guide</a></h1>
<p>This guide goes through all the necessary steps to create a cluster on Hetzner infrastructure (on HCloud &amp; Hetzner Dedicated).</p>
<h2 id="preparing-hetzner"><a class="header" href="#preparing-hetzner">Preparing Hetzner</a></h2>
<p>You have two options: either create a pure HCloud cluster or a hybrid cluster with Hetzner dedicated (bare metal) servers. For a full list of flavors, please check out the <a href="https://github.com/syself/cluster-api-provider-hetzner/releases">release page</a>.</p>
<p>To create a workload cluster, we need to do some preparation:</p>
<ul>
<li>Set up the projects and credentials in HCloud.</li>
<li>Create the management/bootstrap cluster.</li>
<li>Export variables needed for cluster-template.</li>
<li>Create a secret with the credentials.</li>
</ul>
<p>For more information about this step, please see <a href="./preparation.html">here</a></p>
<h2 id="generate-your-clusteryaml"><a class="header" href="#generate-your-clusteryaml">Generate your cluster.yaml</a></h2>
<blockquote>
<p>Please note that ready-to-use Kubernetes configurations, production-ready node images, kubeadm configuration, cluster add-ons like CNI, and similar services need to be separately prepared or acquired to ensure a comprehensive and secure Kubernetes deployment. This is where <strong>Syself Autopilot</strong> comes into play, taking on these challenges to offer you a seamless, worry-free Kubernetes experience. Feel free to contact us via e-mail: info@syself.com.</p>
</blockquote>
<p>The clusterctl generate cluster command returns a YAML template for creating a workload cluster.
It generates a YAML file named <code>my-cluster.yaml</code> with a predefined list of Cluster API objects (<code>Cluster</code>, <code>Machines</code>, <code>MachineDeployments</code>, etc.) to be deployed in the current namespace. </p>
<pre><code class="language-shell">clusterctl generate cluster my-cluster --kubernetes-version v1.28.4 --control-plane-machine-count=3 --worker-machine-count=3  &gt; my-cluster.yaml
</code></pre>
<blockquote>
<p>Note: With the <code>--target-namespace</code> flag, you can specify a different target namespace.
Run the <code>clusterctl generate cluster --help</code> command for more information.</p>
</blockquote>
<p>You can also use different flavors, e.g., to create a cluster with the private network:</p>
<pre><code class="language-shell">clusterctl generate cluster my-cluster --kubernetes-version v1.28.4 --control-plane-machine-count=3 --worker-machine-count=3  --flavor hcloud-network &gt; my-cluster.yaml
</code></pre>
<p>All pre-configured flavors can be found on the <a href="https://github.com/syself/cluster-api-provider-hetzner/releases">release page</a>. The cluster-templates start with <code>cluster-template-</code>. The flavor name is the suffix.</p>
<h2 id="hetzner-dedicated--bare-metal-server"><a class="header" href="#hetzner-dedicated--bare-metal-server">Hetzner Dedicated / Bare Metal Server</a></h2>
<p>If you want to create a cluster with bare metal servers, you will also need to set up the robot credentials in the preparation step. As described in the <a href="/docs/reference/hetzner-bare-metal-machine-template.html">reference</a>, you need to buy bare metal servers beforehand manually. To use bare metal servers for your deployment, you should choose one of the following flavors:</p>
<div class="table-wrapper"><table><thead><tr><th>Flavor</th><th>What it does</th></tr></thead><tbody>
<tr><td>hetzner-baremetal-control-planes-remediation</td><td>Uses bare metal servers for the control plane nodes - with custom remediation (try to reboot machines first)</td></tr>
<tr><td>hetzner-baremetal-control-planes</td><td>Uses bare metal servers for the control plane nodes - with normal remediation (unprovision/recreate machines)</td></tr>
<tr><td>hetzner-hcloud-control-planes</td><td>Uses the hcloud servers for the control plane nodes and the bare metal servers for the worker nodes</td></tr>
</tbody></table>
</div>
<p>Next, you need to create a <code>HetznerBareMetalHost</code> object for each bare metal server that you bought and specify its server ID in the specs. Refer to an example <a href="/docs/reference/hetzner-bare-metal-host.html">here</a>. Add the created objects to your <code>my-cluster.yaml</code> file. If you already know the WWN of the storage device you want to choose for booting, specify it in the <code>rootDeviceHints</code> of the object. If not, you can apply the workload cluster, start the provisioning without specifying the WWN, and then wait for the bare metal hosts to show an error.</p>
<p>After that, look at the status of <code>HetznerBareMetalHost</code> by running <code>kubectl describe hetznerbaremetalhost</code> in your management cluster. There you will find <code>hardwareDetails</code> of all of your bare metal hosts, in which you can see a list of all the relevant storage devices as well as their properties. You can copy+paste the WWN:s of your desired storage device into the <code>rootDeviceHints</code> of your <code>HetznerBareMetalHost</code> objects.</p>
<h2 id="apply-the-workload-cluster"><a class="header" href="#apply-the-workload-cluster">Apply the workload cluster</a></h2>
<pre><code class="language-shell">kubectl apply -f my-cluster.yaml
</code></pre>
<h3 id="accessing-the-workload-cluster"><a class="header" href="#accessing-the-workload-cluster">Accessing the workload cluster</a></h3>
<p>The cluster will now start provisioning. You can check status with:</p>
<pre><code class="language-shell">kubectl get cluster
</code></pre>
<p>You can also view the cluster and its resources at a glance by running:</p>
<pre><code class="language-shell">clusterctl describe cluster my-cluster
</code></pre>
<p>To verify the first control plane is up, use this command:</p>
<pre><code class="language-shell">kubectl get kubeadmcontrolplane
</code></pre>
<blockquote>
<p>The control plane won’t be <code>ready</code> until we install a CNI in the next step.</p>
</blockquote>
<p>After the first control plane node is up and running, we can retrieve the kubeconfig of the workload cluster:</p>
<pre><code class="language-shell">export CAPH_WORKER_CLUSTER_KUBECONFIG=/tmp/workload-kubeconfig
clusterctl get kubeconfig my-cluster &gt; $CAPH_WORKER_CLUSTER_KUBECONFIG
</code></pre>
<h2 id="deploy-a-cni-solution"><a class="header" href="#deploy-a-cni-solution">Deploy a CNI solution</a></h2>
<pre><code class="language-shell">helm repo add cilium https://helm.cilium.io/

KUBECONFIG=$CAPH_WORKER_CLUSTER_KUBECONFIG helm upgrade --install cilium cilium/cilium --version 1.14.4 \
--namespace kube-system \
-f templates/cilium/cilium.yaml
</code></pre>
<p>You can, of course, also install an alternative CNI, e.g., calico.</p>
<blockquote>
<p>There is a bug in Ubuntu that requires the older version of Cilium for this quickstart guide.</p>
</blockquote>
<h2 id="deploy-the-ccm"><a class="header" href="#deploy-the-ccm">Deploy the CCM</a></h2>
<h3 id="deploy-hcloud-cloud-controller-manager---hcloud-only"><a class="header" href="#deploy-hcloud-cloud-controller-manager---hcloud-only">Deploy HCloud Cloud Controller Manager - <em>hcloud only</em></a></h3>
<p>This <code>make</code> command will install the CCM in your workload cluster.</p>
<p><code>make install-ccm-in-wl-cluster PRIVATE_NETWORK=false</code></p>
<pre><code class="language-shell"># For a cluster without a private network:
helm repo add syself https://charts.syself.com
helm repo update syself

KUBECONFIG=$CAPH_WORKER_CLUSTER_KUBECONFIG helm upgrade --install ccm syself/ccm-hcloud --version 1.0.11 \
	--namespace kube-system \
	--set secret.name=hetzner \
	--set secret.tokenKeyName=hcloud \
	--set privateNetwork.enabled=false
</code></pre>
<h3 id="deploy-hetzner-cloud-controller-manager"><a class="header" href="#deploy-hetzner-cloud-controller-manager">Deploy Hetzner Cloud Controller Manager</a></h3>
<blockquote>
<p>This requires a secret containing access credentials to both Hetzner Robot and HCloud</p>
</blockquote>
<p><code>make install-manifests-ccm-hetzner PRIVATE_NETWORK=false</code></p>
<pre><code class="language-shell">helm repo add syself https://charts.syself.com
helm repo update syself

KUBECONFIG=$CAPH_WORKER_CLUSTER_KUBECONFIG helm upgrade --install ccm syself/ccm-hetzner --version 1.1.10 \
--namespace kube-system \
--set privateNetwork.enabled=false
</code></pre>
<h2 id="deploy-the-csi-optional"><a class="header" href="#deploy-the-csi-optional">Deploy the CSI (optional)</a></h2>
<pre><code class="language-shell">cat &lt;&lt; EOF &gt; csi-values.yaml
storageClasses:
- name: hcloud-volumes
  defaultStorageClass: true
  reclaimPolicy: Retain
EOF

KUBECONFIG=$CAPH_WORKER_CLUSTER_KUBECONFIG helm upgrade --install csi syself/csi-hcloud --version 0.2.0 \
--namespace kube-system -f csi-values.yaml
</code></pre>
<h2 id="clean-up"><a class="header" href="#clean-up">Clean Up</a></h2>
<p>Delete workload cluster.</p>
<pre><code class="language-shell">kubectl delete cluster my-cluster
</code></pre>
<blockquote>
<p><strong>IMPORTANT</strong>: In order to ensure a proper clean-up of your infrastructure, you must always delete the cluster object. Deleting the entire cluster template with kubectl delete -f capi-quickstart.yaml might lead to pending resources that have to be cleaned up manually.</p>
</blockquote>
<p>Delete management cluster with</p>
<pre><code class="language-shell">kind delete cluster
</code></pre>
<h2 id="next-steps"><a class="header" href="#next-steps">Next Steps</a></h2>
<h3 id="switch-to-the-workload-cluster"><a class="header" href="#switch-to-the-workload-cluster">Switch to the workload cluster</a></h3>
<pre><code class="language-shell">export KUBECONFIG=/tmp/workload-kubeconfig
</code></pre>
<h3 id="moving-components"><a class="header" href="#moving-components">Moving components</a></h3>
<p>To move the Cluster API objects from your bootstrap cluster to the new management cluster, you need first to install the Cluster API controllers. To install the components with the latest version, please run:</p>
<pre><code class="language-shell">clusterctl init --core cluster-api --bootstrap kubeadm --control-plane kubeadm --infrastructure hetzner

</code></pre>
<p>If you want a specific version, use the flag <code>--infrastructure hetzner:vX.X.X</code>.</p>
<p>Now you can switch back to the management cluster, for example, with</p>
<pre><code class="language-shell">export KUBECONFIG=~/.kube/config
</code></pre>
<p>You can now move the objects into the new cluster by using:</p>
<pre><code class="language-shell">clusterctl move --to-kubeconfig $CAPH_WORKER_CLUSTER_KUBECONFIG
</code></pre>
<p>Clusterctl Flags:</p>
<div class="table-wrapper"><table><thead><tr><th>Flag</th><th>Description</th></tr></thead><tbody>
<tr><td><em>--namespace</em></td><td>The namespace where the workload cluster is hosted. If unspecified, the current context's namespace is used.</td></tr>
<tr><td><em>--kubeconfig</em></td><td>Path to the kubeconfig file for the source management cluster. If unspecified, default discovery rules apply.</td></tr>
<tr><td><em>--kubeconfig-context</em></td><td>Context to be used within the kubeconfig file for the source management cluster. If empty, the current context will be used.</td></tr>
<tr><td><em>--to-kubeconfig</em></td><td>Path to the kubeconfig file to use for the destination management cluster.</td></tr>
<tr><td><em>--to-kubeconfig-context</em></td><td>Context to be used within the kubeconfig file for the destination management cluster. If empty, the current context will be used.</td></tr>
</tbody></table>
</div>
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../topics/preparation.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../topics/managing-ssh-keys.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../topics/preparation.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../topics/managing-ssh-keys.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
